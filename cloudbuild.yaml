steps:
# Install dependencies
- name: "python:3.8"
  entrypoint: "pip"
  args: ["install", "--upgrade", "-r", "requirements.txt", "-t", "."]

# Deploy to Cloud Function
- name: "gcr.io/cloud-builders/gcloud"
  entrypoint: "bash"
  args:
  - "-c"
  - |
    gcloud auth activate-service-account --key-file=noble-amp-384713-6597fe149049.json
    gcloud functions deploy nn-test --runtime python310 --trigger-http --source=.
  secretEnv: ['SERVICE_ACCOUNT_KEY']

secrets:
- kmsKeyName: projects/your-project/locations/global/keyRings/your-key-ring/cryptoKeys/your-key
  secretEnv:
    SERVICE_ACCOUNT_KEY: "ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9ibGUtYW1wLTM4NDcxMyIsCiAgInByaXZhdGVfa2V5X2lkIjogIjY1OTdmZTE0OTA0OTdkMDdhMjZiYzczYWI1ZWQ1NWExNGRlYjk5OTQiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQ3lScURYZjR5TFRRRmVcbm5WYWpTOUY0UlFkTTdBMFFJdHNEMjlEQXlFR3AyekdaTnlxUjk0U0hxeHhaK0JGbUNRWHdMRXF5OXZRc3psNkVcbm5FN1B2ZWs1OFRKa1VVQ3RXR3ZKR3AzVW1NNkNpUXNOL3RuUm9DblJaMm12MXV0TTJVU3h0Zms2MWtIbGJRZGVcbjVXSGFkSXE2WFczL2ZHdVVHMVZSRVNyY2FvOHk1OU1VTmhNNHlmWUU5RXdBaWU0Z2E2Y0Exd0hJOG1nUFF1eE5cbng5OU5XZTR5SmcyTERIRVVvWDlsbm9LWjlPM1ZSVkxQN1R4Q1dNWUpvT1RDL2ZKMzhNblZRbVAvV3M1ZFJTMHZcblhDN2dBR3VlL0doYUJ3dUlQZ1k2V1dSYzZhbjMxWGRyUkk2OEpPQmEwWis5OTNPZXpob0JDbVM2VWFibTArU0dcbi8wbmtQbjQ5QWdNQkFBRUNnZ0VBSlErbVFjNkFFUGg3KzZlaFduYTVUL09udWgvTGNtcVFsZHVGYVFKb2xpOWRcbmZ3RFhMbnVpbDFLazVQWTdaYmNqL3lNeUQwVGtDNG1HWURLZmRyUUFEMzNiTUR3dEFpeGkwZTZnMTVEQnc2VEtcblFjbFVqbTNwcTZFQU9XQW9UL1JPQWRTM0FIcUl2ZkY5eWdaTklxMCtKdEtqK3F3cXNDSkRpUVFVNFRnYzEyTzlcbkZXeGpDTVNMNVRYcDl2Z21EY1Y5YkJrSk80aHhZblE3OGRVcVdwNHNucXdFK2MrdzYrY2x2WXBUbFBPN3VySFZcbjQ3VWpTRXdnZmQ1YUFzMnE3OSt1dWprRXBMVFA2WHVpK1pNSlhJK0VuTUlxWnVCckJZMDhmSW1ZRXZjbWdSYjRcbk5zRU92L2xBK1lIeWtHQ0xraUVTN3ZUYTJqWkYzUlRWeEJDWElIdDMyUUtCZ1FEMUh1ZFhzc0EwNURmckJpbWJcblVTOE9qb3lMcmlVQUF5WVBRZU5sSS8ySWFCQ01XRGdSa3M0WGlFSjdkaVhzTTAvV3BDOEc4OUx1STNCNlNEbTRcbjllUzg4aUF0OXVjNXp3MjhtQ1N4bWt4YzlPbWdkMEhiN29XaUVRUkR5MU8vemdWL2paMkptdVRwWW1nOTJVYi9cbmR4WWpFU2M4UCtWOURIQ0w0SUxGT3Zqb0JRS0JnUUM2TURsbTVTV2hpK0ZTU0I5Z0ZOdU0vem5xUzlUbWg1UnJcbjdlTXZ3d2VvMXZ4Rmg0RHlHSUxZY2tBWlVzbUM5enRHT1ZGNjNTb1FFQW1XcjFRSGtwNGMyZVRMTHh1c2MyNHpcbkRkanMwQSt1LzhkaUFEVk5vS081Nk1jalo2V1JQcEkydTZrdVNmRzg5ZXhtTWVCcnd4ck52Qks0SWFNbGVSbFhcbkJ1SEdLRDBxMlFLQmdRQ2NyaU5NQUZzeHM4czJkRnIyQjUrZm0yaWxCQ3hzWkpiWVc5SmhYTzc3V1NGeXhCVWFcbnpvN2pwZHB4Rm1WSkpNZGN1TmZDaHVvR0JDc3FUcTV1MXVaZURCcWJwdDNJS3R4cDk0cEU2QTcxd0NyeHdpa2Jcbnpzd21ldUFTQVk3SDVJWEpNWmxJVXZVTlpUU2lqQmNBeG5zazhScjJQUldRcC9uc3Z4WjN3YWxHalFLQmdIK0NcbjFWMGRvK2IrR0dNMGw2QkN5SlhJbVk1WFBzaGVwQXhDa0N1K29ybEQrdU5YU0wwRWdsL2Y1dnd3MFdjTEVLSW9cblVTQVc1VjY0elFoUXJQaSt0ZUJHYmNXbFRvdU5SalJhMEd4bWxjY2d6eGpUMGEySFRYbmQ3THZYbVBGZTY5M21cbktaaFU5ZVNXZTc4RmU0L3h2NktVb2pGT2dDQUN6cExtV0t0UUZZd0pBb0dBQW84WnlNeC9YYVpSNXVwaG5MaUZcbndYSGdwZDB1TU55dzFLMWxzR0pQY2sveThqazQ1S21JWGh5TXBITTBxSzJRZDR4VkptMVh1b3BWY1kvSDY4ZytcblBLSmFQVWpNTzJSdjh3T3RpdGYzdDhqcTgvb1pjZ3F6QlF6azR5clRaby9kQ2hYQThLd3ZLallxUVVpUFlBVS9cbmNTM0dhemRTcDl5dzFWaGUxZTRhL2VzPVxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogIm5uLWFjY291bnQtc2VydmljZS10ZXN0QG5vYmxlLWFtcC0zODQ3MTMuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJjbGllbnRfaWQiOiAiMTE0NTQ2MjMyNDcwOTI2MTcyNjkyIiwKICAiYXV0aF91cmkiOiAiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGgiLAogICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS9ubi1hY2NvdW50LXNlcnZpY2UtdGVzdCU0MG5vYmxlLWFtcC0zODQ3MTMuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJ1bml2ZXJzZV9kb21haW4iOiAiZ29vZ2xlYXBpcy5jb20iCn0K"
